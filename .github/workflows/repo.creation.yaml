name: "Automate Repo Creation"
on:
 issues:
   types: [opened]
jobs:
 create-repo:
   if: github.event.issue.labels.*.name contains 'repo-request'
   runs-on: ubuntu-latest
   steps:
     - name: Extract issue data
       id: extract
       run: |
         echo "::set-output name=repo_name::$(echo '${{ github.event.issue.body }}' | grep 'Repository Name' | cut -d':' -f2 | xargs)"
         echo "::set-output name=repo_description::$(echo '${{ github.event.issue.body }}' | grep 'Repository Description' | cut -d':' -f2 | xargs)"
         echo "::set-output name=repo_visibility::$(echo '${{ github.event.issue.body }}' | grep 'Repository Visibility' | cut -d':' -f2 | xargs | tr '[:upper:]' '[:lower:]')"
     - name: Create repository using GitHub API
       env:
         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
       run: |
         curl \
           -X POST \
           -H "Authorization: token $GITHUB_TOKEN" \
           -H "Accept: application/vnd.github.v3+json" \ https://github.com/GCoder-tech/repotest \
           -d '{"name": "${{ steps.extract.outputs.repo_name }}", "description": "${{ steps.extract.outputs.repo_description }}", "private": $([[ "${{ steps.extract.outputs.repo_visibility }}" == "private" ]] && echo true || echo false)}'
